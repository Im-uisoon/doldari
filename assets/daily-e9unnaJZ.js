import{f as r,k as G,a as s,o as a,l as b,b as n,t as i,F as f,e as w,n as E,d as V,w as S,r as F,p as d}from"./index-Bs8UQIvk.js";const B={key:0,class:"fixed inset-0 bg-[rgba(0,0,0,0.75)] flex justify-center items-center z-50"},M={class:"bg-[#FFFEEF] p-6 rounded-lg shadow-xl w-11/12 max-w-md"},z={class:"text-xl font-bold mb-2"},J={key:0,class:"text-sm text-gray-700 mb-3"},$={class:"list-disc pl-5 text-sm text-gray-800 space-y-1 mb-4"},U={key:1,class:"text-xs text-gray-500 mb-4"},q={class:"flex items-center justify-between"},H={class:"text-sm text-gray-600"},K=["disabled"],Q={class:"background-out flex justify-center items-center"},W={class:"background-in w-full"},X={class:"head-setting mb-15"},Y={class:"w-full space-y-6 sm:space-y-8"},Z={key:0,class:"text-center text-gray-600 py-10"},tt={key:1,class:"text-center text-red-600 py-10"},et={key:2,class:"grid gap-3"},nt=["onClick"],st={class:"font-bold text-base sm:text-lg"},at={class:"text-sm sm:text-base font-semibold"},ot={key:3,class:"mt-6"},it={key:0,class:"text-center text-gray-600 py-6"},rt={key:1,class:"text-center text-red-600 py-6"},lt={key:2,class:"space-y-4"},ct={class:"px-4 py-3 bg-gray-50 flex items-center justify-between"},dt={class:"font-semibold text-gray-800"},ut={class:"text-xs text-gray-500"},_t={class:"divide-y"},gt={class:"text-sm font-medium"},yt={__name:"daily",setup(pt){const N={TRAINING_01:()=>d(()=>import("./TRAINING_01-KNYnu0Ta.js"),[]).then(t=>({title:t.training01?.title,subtitle:t.training01?.subtitle,content:t.training01?.content,footer:t.training01?.footer})),TRAINING_02:()=>d(()=>import("./TRAINING_02-v2P6K8rM.js"),[]).then(t=>({title:t.training02?.title,subtitle:t.training02?.subtitle,content:t.training02?.content,footer:t.training02?.footer})),TRAINING_03:()=>d(()=>import("./TRAINING_03-DxUkdg9F.js"),[]).then(t=>({title:t.training03?.title,subtitle:t.training03?.subtitle,content:t.training03?.content,footer:t.training03?.footer})),TRAINING_04:()=>d(()=>import("./TRAINING_04-RCcIHXb_.js"),[]).then(t=>({title:t.training04?.title,subtitle:t.training04?.subtitle,content:t.training04?.content,footer:t.training04?.footer})),TRAINING_05:()=>d(()=>import("./TRAINING_05-BEqwYuA0.js"),[]).then(t=>({title:t.training05?.title,subtitle:t.training05?.subtitle,content:t.training05?.content,footer:t.training05?.footer})),TRAINING_06:()=>d(()=>import("./TRAINING_06-DPH2zlfX.js"),[]).then(t=>({title:t.training06?.title,subtitle:t.training06?.subtitle,content:t.training06?.content,footer:t.training06?.footer})),TRAINING_07:()=>d(()=>import("./TRAINING_07-Bk8Dlu4d.js"),[]).then(t=>({title:t.training07?.title,subtitle:t.training07?.subtitle,content:t.training07?.content,footer:t.training07?.footer})),TRAINING_08:()=>d(()=>import("./TRAINING_08-CytwLtNR.js"),[]).then(t=>({title:t.training08?.title,subtitle:t.training08?.subtitle,content:t.training08?.content,footer:t.training08?.footer}))},y=r([]),I=r(!1),h=r(""),m=r(!1),A=r([]),k=r(!1),g=r(""),T=r(!1),c=r(null),u=r(5);let v=null,p=null;const D=async()=>{I.value=!0,h.value="";try{const t=await fetch("http://localhost:8080/api/user/today",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!t.ok)throw new Error("목록을 불러오지 못했습니다");const e=await t.json();y.value=Array.isArray(e)?e:[]}catch(t){h.value=t?.message||"오류가 발생했습니다"}finally{I.value=!1}},R=t=>[t.done?"bg-green-100 border-green-300 text-green-900":"bg-gray-100 border-gray-300 text-gray-700"],j=async t=>{if(!t.done)try{const e=N[t.trainingCode];if(!e)throw new Error("교육 자료가 없습니다");c.value=await e(),p=t,u.value=5,T.value=!0,C()}catch(e){alert(e?.message||"교육 자료를 불러오지 못했습니다")}},C=()=>{clearInterval(v),v=setInterval(()=>{u.value>0&&(u.value-=1),u.value<=0&&(clearInterval(v),v=null)},1e3)},L=async()=>{if(p)try{const t=await fetch("http://localhost:8080/api/user/today/complete",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({dailyTrainingId:p.dailyTrainingId})});if(!t.ok){const e=await t.text();throw new Error(e||"완료 처리 실패")}y.value=y.value.map(e=>e.dailyTrainingId===p.dailyTrainingId?{...e,done:!0,doneDate:new Date().toISOString()}:e),T.value=!1,c.value=null,p=null}catch(t){alert(t?.message||"완료 중 오류")}};G(()=>{D(),O()});const O=async()=>{try{const t=await fetch("http://localhost:8080/api/user/profile",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(t.ok){const e=await t.json(),_=String(e?.role||"").toLowerCase();if(m.value=_==="leader",m.value){const o=sessionStorage.getItem("loggedInUser"),l=o?JSON.parse(o):null,x=l?.siteId??l?.site?.id??null;x==null?g.value="현장 식별자(siteId)를 찾을 수 없습니다.":await P(x)}}}catch{}},P=async t=>{k.value=!0,g.value="";try{const e=await fetch(`http://localhost:8080/api/location/sites/${t}/training-status`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error("팀 현황을 불러오지 못했습니다");const _=await e.json();A.value=Array.isArray(_)?_:[]}catch(e){g.value=e?.message||"오류가 발생했습니다"}finally{k.value=!1}};return(t,e)=>{const _=F("router-link");return a(),s(f,null,[T.value?(a(),s("div",B,[n("div",M,[n("h2",z,i(c.value?.title),1),c.value?.subtitle?(a(),s("p",J,i(c.value.subtitle),1)):b("",!0),n("ul",$,[(a(!0),s(f,null,w(c.value?.content||[],(o,l)=>(a(),s("li",{key:l},i(o),1))),128))]),c.value?.footer?(a(),s("p",U,i(c.value.footer),1)):b("",!0),n("div",q,[n("span",H,"완료 가능까지 "+i(u.value)+"초",1),n("button",{disabled:u.value>0,onClick:L,class:E(["py-2 px-4 rounded font-bold",u.value>0?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-[#1D1A05] text-[#FFEA00]"])},"완료",10,K)])])])):b("",!0),n("div",Q,[n("div",W,[n("header",X,[V(_,{to:"/main",class:"heed-text"},{default:S(()=>[...e[0]||(e[0]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),e[1]||(e[1]=n("h1",{class:"text-3xl font-bold text-[#78711D]"},"오늘의 점검/교육",-1)),e[2]||(e[2]=n("p",null,null,-1))]),n("main",Y,[I.value?(a(),s("div",Z,"불러오는 중…")):h.value?(a(),s("div",tt,i(h.value),1)):(a(),s("div",et,[(a(!0),s(f,null,w(y.value,o=>(a(),s("button",{key:o.dailyTrainingId,onClick:l=>j(o),class:E([R(o),"flex items-center justify-between px-4 py-4 rounded-2xl border"])},[n("span",st,i(o.taskName),1),n("span",at,i(o.done?"이수":"미이수"),1)],10,nt))),128))])),m.value?(a(),s("section",ot,[e[3]||(e[3]=n("h2",{class:"text-2xl font-bold text-[#78711D] mb-3"},"팀원 교육 현황",-1)),k.value?(a(),s("div",it,"팀 현황 불러오는 중…")):g.value?(a(),s("div",rt,i(g.value),1)):(a(),s("div",lt,[(a(!0),s(f,null,w(A.value,o=>(a(),s("div",{key:o.userId,class:"rounded-xl border border-gray-200 bg-white overflow-hidden"},[n("div",ct,[n("span",dt,i(o.userName),1),n("span",ut,"ID: "+i(o.userId),1)]),n("div",_t,[(a(!0),s(f,null,w(o.dailyTrainings||[],(l,x)=>(a(),s("div",{key:x,class:"flex items-center justify-between px-4 py-3"},[n("span",gt,i(l.taskName),1),n("span",{class:E(l.done?"text-green-700 font-semibold":"text-gray-600")},i(l.done?"이수":"미이수"),3)]))),128))])]))),128))]))])):b("",!0)])])])],64)}}};export{yt as default};
