import{_ as j,f as p,k as O,c as k,a as d,o as r,b as e,d as E,w as N,r as B,i as w,m as y,F as b,e as f,t as m,n as F}from"./index-hAIkE_zO.js";const I={class:"background-out"},M={class:"background-in"},V={class:"head-setting mb-4"},$={class:"grid grid-cols-1 gap-3"},J={class:"brown-box p-4 flex flex-col gap-2"},L={class:"grid grid-cols-1 md:grid-cols-2 gap-3 w-full"},P=["value"],R=["disabled"],U=["value"],z={class:"brown-box p-4 flex flex-col"},G={class:"mt-3 text-center text-white text-sm"},K={class:"brown-box p-4 flex flex-col gap-2"},Y={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},q=["onClick"],H=["disabled"],Q={__name:"AdminTask",setup(W){const x=p([]),c=p(null),u=p(null),i=p(""),a=p([]),h=["철근배근","용접작업","비계설치","나사박음질","콘크리트타설","절단연마작업","전기공사","고소작업"];O(_);async function _(){const o=await fetch("https://doldariback-production.up.railway.app/api/location",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!o.ok)return;const t=await o.json().catch(()=>[]),n=new Map;for(const s of Array.isArray(t)?t:[]){const l=s?.region||{};!l?.id||!l?.name||(n.has(l.id)||n.set(l.id,{id:l.id,name:l.name,sites:[]}),n.get(l.id).sites.push({id:s.id,name:s.name}))}x.value=Array.from(n.values())}const C=k(()=>x.value.find(t=>t.id===c.value)?.sites??[]);function A(){i.value=g(new Date)}function D(){const o=new Date;o.setDate(o.getDate()+1),i.value=g(o)}function g(o){const t=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${t}-${n}-${s}`}function S(o){const t=a.value.indexOf(o);t>=0?a.value.splice(t,1):a.value.push(o)}const v=k(()=>!!(u.value&&i.value&&a.value.length));async function T(){if(!v.value)return;const o={siteId:Number(u.value),taskDate:i.value,tasks:[...a.value]};try{const t=await fetch("https://doldariback-production.up.railway.app/api/task",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(o)});if(!t.ok){let n="작업 지정 전송에 실패했습니다.";try{if((t.headers.get("content-type")||"").includes("application/json")){const l=await t.json();n=l&&(l.message||l.error||JSON.stringify(l))||n}else n=await t.text()||n}catch{}alert(n);return}alert("작업 지정이 완료되었습니다."),c.value=null,u.value=null,i.value="",a.value=[]}catch{alert("네트워크 오류로 작업 지정에 실패했습니다.")}}return(o,t)=>{const n=B("router-link");return r(),d("div",I,[e("div",M,[e("header",V,[E(n,{to:"/admin",class:"heed-text flex items-center justify-center w-10 h-10"},{default:N(()=>[...t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),t[3]||(t[3]=e("h1",{class:"text-2xl md:text-3xl font-bold text-[#78711D] text-center"},"작업 지정",-1)),t[4]||(t[4]=e("div",{class:"w-10"},null,-1))]),e("main",$,[e("section",J,[t[7]||(t[7]=e("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"현장과 팀 선택",-1)),e("div",L,[e("div",null,[w(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),class:"input-box w-full p-2 rounded-md"},[t[5]||(t[5]=e("option",{value:null},"현장 선택",-1)),(r(!0),d(b,null,f(x.value,s=>(r(),d("option",{key:s.id,value:s.id},m(s.name),9,P))),128))],512),[[y,c.value]])]),e("div",null,[w(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),class:"input-box w-full p-2 rounded-md",disabled:!c.value},[t[6]||(t[6]=e("option",{value:null},"팀 선택",-1)),(r(!0),d(b,null,f(C.value,s=>(r(),d("option",{key:s.id,value:s.id},m(s.name),9,U))),128))],8,R),[[y,u.value]])])]),t[8]||(t[8]=e("p",{class:"text-xs text-gray-300 mt-2"},"현장과 팀을 선택하면 지정 준비가 완료됩니다.",-1))]),e("section",z,[t[9]||(t[9]=e("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"작업 날짜 선택",-1)),e("div",{class:"flex gap-3 w-full justify-center"},[e("button",{onClick:A,class:"px-8 py-2 rounded-md border bg-black text-[#3A9CFF] border-[#3A9CFF]"},"금일"),e("button",{onClick:D,class:"px-8 py-2 rounded-md border bg-black text-[#3A9CFF] border-[#3A9CFF]"},"익일")]),e("div",G,"선택된 날짜: "+m(i.value||"미선택"),1)]),e("section",K,[t[10]||(t[10]=e("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"작업 선택",-1)),e("div",Y,[(r(),d(b,null,f(h,s=>e("button",{key:s,onClick:l=>S(s),class:F(["px-3 py-2 rounded-md border font-medium",a.value.includes(s)?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},m(s),11,q)),64))]),t[11]||(t[11]=e("p",{class:"text-xs text-gray-300 mt-2"},"여러 개를 선택할 수 있습니다.",-1))]),e("section",null,[e("button",{onClick:T,disabled:!v.value,class:F(["w-full bg-black text-[#3A9CFF] border border-[#3A9CFF] font-bold py-3 rounded-md",v.value?"":"opacity-60 cursor-not-allowed"])},"작업 지정 전송",10,H)])])])])}}},Z=j(Q,[["__scopeId","data-v-0444cd72"]]);export{Z as default};
