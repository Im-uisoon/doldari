import{_ as M,f as p,c as T,k as I,a as c,o as u,b as o,d as K,w as P,r as W,F as A,e as D,n as b,t as h,i as F,v as _,l as E}from"./index-BIVXEOUW.js";const G={class:"background-out"},z={class:"background-in"},q={class:"head-setting mb-4"},H={class:"grid grid-cols-1 gap-3"},Q={class:"brown-box p-4 flex flex-col"},X={class:"overflow-y-auto max-h-64 w-full flex flex-col gap-2"},Y={class:"truncate"},Z=["onClick"],ee={class:"mt-4"},te={class:"brown-box p-4 flex flex-col"},oe={class:"overflow-y-auto max-h-64 flex flex-col gap-2 w-full"},le={class:"truncate"},ae=["onClick"],ne={key:0,class:"text-white text-center"},se={class:"mt-4"},ie=["disabled"],re=["disabled"],de={class:"brown-box p-4 flex flex-col"},ce={class:"overflow-y-auto max-h-64 flex flex-col gap-2 w-full"},ue={class:"min-w-0"},pe={class:"font-semibold truncate"},ve={class:"text-xs text-gray-700 truncate"},fe=["onClick"],be={key:0,class:"text-white text-center"},me={class:"mt-4 w-full"},he=["disabled"],xe={key:0,class:"mt-3 grid grid-cols-1 gap-2"},we={class:"mt-4"},ye=["disabled"],ge={__name:"AdminList",setup(ke){const f=p([]),a=p(null),s=p(null),r=p([]),d=p(null),x=p(""),w=p(""),y=p(!1),v=p({name:"",phone:"",role:"WORKER"}),j=T(()=>a.value?.sites??[]),S=T(()=>!!(d.value||s.value||a.value));I(async()=>{await C()});async function C(){const l=await fetch("https://doldariback-production.up.railway.app/api/location",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!l.ok)return;const e=await l.json().catch(()=>[]),n=new Map;for(const t of Array.isArray(e)?e:[]){const i=t?.region||{};!i?.id||!i?.name||(n.has(i.id)||n.set(i.id,{id:i.id,name:i.name,sites:[]}),n.get(i.id).sites.push({id:t.id,name:t.name}))}f.value=Array.from(n.values()),a.value=null,s.value=null,d.value=null,r.value=[]}function R(l){a.value=l,s.value=null,d.value=null,r.value=[]}async function N(l){s.value=l,d.value=null,await O(l.id)}function U(l){d.value=l}async function O(l){r.value=[];const e=await fetch(`https://doldariback-production.up.railway.app/api/location/sites/${l}/users`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)return;const n=await e.json().catch(()=>[]);r.value=Array.isArray(n)?n.map(t=>({id:t.id,name:t.name,phone:t.phone,role:t.role||"WORKER"})):[]}async function $(){const l=x.value.trim();if(!l)return alert("현장 이름을 입력하세요.");if(!(await fetch("https://doldariback-production.up.railway.app/api/location/regions",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:l})})).ok)return alert("현장 추가에 실패했습니다.");x.value="",await C()}async function B(){if(!a.value)return alert("먼저 현장을 선택하세요.");const l=w.value.trim();if(!l)return alert("팀 이름을 입력하세요.");if(!(await fetch("https://doldariback-production.up.railway.app/api/location/sites",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:l,regionId:a.value.id})})).ok)return alert("팀 추가에 실패했습니다.");w.value="",await C();const n=f.value.find(t=>t.id===a.value.id);n&&(a.value=n)}async function L(){if(!s.value||!a.value)return alert("현장과 팀을 먼저 선택하세요.");const l=(v.value.name||"").trim(),n=(v.value.phone||"").replace(/\D+/g,""),t="worker";if(!l||!n)return alert("이름/전화는 필수입니다.");const i=Number(s.value.id),g=await fetch("https://doldariback-production.up.railway.app/api/location/users",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:l,phone:n,role:t,siteId:i})});if(!g.ok){let m="팀원 추가에 실패했습니다.";try{if((g.headers.get("content-type")||"").includes("application/json")){const k=await g.json();m=k&&(k.message||k.error||JSON.stringify(k))||m}else m=await g.text()||m}catch{}alert(m);return}v.value={name:"",phone:"",role:"WORKER"},y.value=!1,await O(s.value.id)}async function V(){try{if(d.value){if(!(await fetch(`https://doldariback-production.up.railway.app/api/location/users/${d.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("팀원 삭제에 실패했습니다.");r.value=r.value.filter(e=>e.id!==d.value.id),d.value=null;return}if(s.value){if(!(await fetch(`https://doldariback-production.up.railway.app/api/location/sites/${s.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("팀 삭제에 실패했습니다.");const e=f.value.find(n=>n.id===a.value?.id);e&&(e.sites=e.sites.filter(n=>n.id!==s.value.id)),s.value=null,r.value=[];return}if(a.value){if(!(await fetch(`https://doldariback-production.up.railway.app/api/location/regions/${a.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("현장 삭제에 실패했습니다.");f.value=f.value.filter(e=>e.id!==a.value.id),a.value=null,s.value=null,r.value=[];return}}catch{alert("삭제 처리 중 오류가 발생했습니다.")}}return(l,e)=>{const n=W("router-link");return u(),c("div",G,[o("div",z,[o("header",q,[K(n,{to:"/admin",class:"heed-text flex items-center justify-center w-10 h-10"},{default:P(()=>[...e[5]||(e[5]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),e[6]||(e[6]=o("h1",{class:"text-2xl md:text-3xl font-bold text-[#78711D] text-center"},"명단 관리",-1)),e[7]||(e[7]=o("div",{class:"w-10"},null,-1))]),o("main",H,[o("section",Q,[e[8]||(e[8]=o("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"현장(지역)",-1)),o("div",X,[(u(!0),c(A,null,D(f.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",a.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[o("span",Y,h(t.name),1),o("button",{type:"button",onClick:i=>R(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,Z)],2))),128))]),o("div",ee,[F(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),type:"text",placeholder:"새 현장 이름을 입력해주세요",class:"input-box rounded-md w-full p-2"},null,512),[[_,x.value]]),o("button",{onClick:$,class:"w-full mt-2 bg-black text-[#3A9CFF] border border-[#3A9CFF] font-bold py-2 rounded-md"},"현장 추가")])]),o("section",te,[e[9]||(e[9]=o("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"팀",-1)),o("div",oe,[(u(!0),c(A,null,D(j.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",s.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[o("span",le,h(t.name),1),o("button",{type:"button",onClick:i=>N(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,ae)],2))),128)),a.value&&j.value.length===0?(u(),c("p",ne,"등록된 팀이 없습니다.")):E("",!0)]),o("div",se,[F(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),type:"text",placeholder:"새 팀 이름을 입력해주세요",class:"input-box rounded-md w-full p-2",disabled:!a.value},null,8,ie),[[_,w.value]]),o("button",{onClick:B,disabled:!a.value,class:b(["w-full mt-2 font-bold py-2 rounded-md border",a.value?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-300 text-gray-600"])},"팀 추가",10,re)])]),o("section",de,[e[10]||(e[10]=o("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"팀원",-1)),o("div",ce,[(u(!0),c(A,null,D(r.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",d.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[o("div",ue,[o("div",pe,h(t.name),1),o("div",ve,h(t.role)+" · "+h(t.phone),1)]),o("button",{type:"button",onClick:i=>U(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,fe)],2))),128)),s.value&&r.value.length===0?(u(),c("p",be,"등록된 팀원이 없습니다.")):E("",!0)]),o("div",me,[o("button",{onClick:e[2]||(e[2]=t=>y.value=!y.value),disabled:!s.value,class:b(["w-full mt-2 font-bold py-2 rounded-md border",s.value?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-300 text-gray-600"])},"팀원 추가하기",10,he),y.value?(u(),c("div",xe,[F(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.name=t),type:"text",placeholder:"이름을 입력해주세요",class:"input-box rounded-md w-full p-2"},null,512),[[_,v.value.name]]),F(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>v.value.phone=t),type:"text",placeholder:"전화번호를 입력해주세요 (- 입력 없이 등록)",class:"input-box rounded-md w-full p-2"},null,512),[[_,v.value.phone]]),o("button",{onClick:L,class:"w-full bg-black text-[#3A9CFF] border border-[#3A9CFF] font-bold py-2 rounded-md"},"팀원 추가")])):E("",!0)])])]),o("footer",we,[o("button",{onClick:V,class:b(["w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl",S.value?"":"opacity-60 cursor-not-allowed"]),disabled:!S.value},"삭제하기",10,ye),e[11]||(e[11]=o("p",{class:"text-xs text-gray-300 mt-2"},"가이드 : 선택 수준에 따라 삭제 대상이 달라집니다: 현장만 선택 → 현장 및 하위 전체 / 팀 선택 → 팀 및 팀원 / 팀원 선택 → 해당 팀원",-1))])])])}}},_e=M(ge,[["__scopeId","data-v-b9ebe7dc"]]);export{_e as default};
