import{_ as M,f as p,c as T,k as I,a as c,o as u,b as l,d as K,w as P,r as W,F as A,e as D,n as b,t as h,i as _,v as k,l as E}from"./index-Bs8UQIvk.js";const G={class:"background-out"},z={class:"background-in"},q={class:"head-setting mb-4"},H={class:"grid grid-cols-1 gap-3"},Q={class:"brown-box p-4 flex flex-col"},X={class:"overflow-y-auto max-h-64 w-full flex flex-col gap-2"},Y={class:"truncate"},Z=["onClick"],ee={class:"mt-4"},te={class:"brown-box p-4 flex flex-col"},le={class:"overflow-y-auto max-h-64 flex flex-col gap-2 w-full"},oe={class:"truncate"},ne=["onClick"],ae={key:0,class:"text-white text-center"},se={class:"mt-4"},ie=["disabled"],re=["disabled"],de={class:"brown-box p-4 flex flex-col"},ce={class:"overflow-y-auto max-h-64 flex flex-col gap-2 w-full"},ue={class:"min-w-0"},pe={class:"font-semibold truncate"},ve={class:"text-xs text-gray-700 truncate"},fe=["onClick"],be={key:0,class:"text-white text-center"},me={class:"mt-4 w-full"},he=["disabled"],xe={key:0,class:"mt-3 grid grid-cols-1 gap-2"},ge={class:"mt-4"},we=["disabled"],ye={__name:"AdminList",setup(Fe){const f=p([]),n=p(null),s=p(null),r=p([]),d=p(null),x=p(""),g=p(""),w=p(!1),v=p({name:"",phone:"",role:"WORKER"}),j=T(()=>n.value?.sites??[]),S=T(()=>!!(d.value||s.value||n.value));I(async()=>{await C()});async function C(){const o=await fetch("http://localhost:8080/api/location",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!o.ok)return;const e=await o.json().catch(()=>[]),a=new Map;for(const t of Array.isArray(e)?e:[]){const i=t?.region||{};!i?.id||!i?.name||(a.has(i.id)||a.set(i.id,{id:i.id,name:i.name,sites:[]}),a.get(i.id).sites.push({id:t.id,name:t.name}))}f.value=Array.from(a.values()),n.value=null,s.value=null,d.value=null,r.value=[]}function R(o){n.value=o,s.value=null,d.value=null,r.value=[]}async function N(o){s.value=o,d.value=null,await O(o.id)}function U(o){d.value=o}async function O(o){r.value=[];const e=await fetch(`http://localhost:8080/api/location/sites/${o}/users`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)return;const a=await e.json().catch(()=>[]);r.value=Array.isArray(a)?a.map(t=>({id:t.id,name:t.name,phone:t.phone,role:t.role||"WORKER"})):[]}async function $(){const o=x.value.trim();if(!o)return alert("현장 이름을 입력하세요.");if(!(await fetch("http://localhost:8080/api/location/regions",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:o})})).ok)return alert("현장 추가에 실패했습니다.");x.value="",await C()}async function B(){if(!n.value)return alert("먼저 현장을 선택하세요.");const o=g.value.trim();if(!o)return alert("팀 이름을 입력하세요.");if(!(await fetch("http://localhost:8080/api/location/sites",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:o,regionId:n.value.id})})).ok)return alert("팀 추가에 실패했습니다.");g.value="",await C();const a=f.value.find(t=>t.id===n.value.id);a&&(n.value=a)}async function L(){if(!s.value||!n.value)return alert("현장과 팀을 먼저 선택하세요.");const o=(v.value.name||"").trim(),a=(v.value.phone||"").replace(/\D+/g,""),t="worker";if(!o||!a)return alert("이름/전화는 필수입니다.");const i=Number(s.value.id),y=await fetch("http://localhost:8080/api/location/users",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({name:o,phone:a,role:t,siteId:i})});if(!y.ok){let m="팀원 추가에 실패했습니다.";try{if((y.headers.get("content-type")||"").includes("application/json")){const F=await y.json();m=F&&(F.message||F.error||JSON.stringify(F))||m}else m=await y.text()||m}catch{}alert(m);return}v.value={name:"",phone:"",role:"WORKER"},w.value=!1,await O(s.value.id)}async function V(){try{if(d.value){if(!(await fetch(`http://localhost:8080/api/location/users/${d.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("팀원 삭제에 실패했습니다.");r.value=r.value.filter(e=>e.id!==d.value.id),d.value=null;return}if(s.value){if(!(await fetch(`http://localhost:8080/api/location/sites/${s.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("팀 삭제에 실패했습니다.");const e=f.value.find(a=>a.id===n.value?.id);e&&(e.sites=e.sites.filter(a=>a.id!==s.value.id)),s.value=null,r.value=[];return}if(n.value){if(!(await fetch(`http://localhost:8080/api/location/regions/${n.value.id}`,{method:"DELETE",headers:{Accept:"application/json"},credentials:"include"})).ok)return alert("현장 삭제에 실패했습니다.");f.value=f.value.filter(e=>e.id!==n.value.id),n.value=null,s.value=null,r.value=[];return}}catch{alert("삭제 처리 중 오류가 발생했습니다.")}}return(o,e)=>{const a=W("router-link");return u(),c("div",G,[l("div",z,[l("header",q,[K(a,{to:"/admin",class:"heed-text flex items-center justify-center w-10 h-10"},{default:P(()=>[...e[5]||(e[5]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2.5",stroke:"#78711D",class:"w-6 h-6"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5 8.25 12l7.5-7.5"})],-1)])]),_:1}),e[6]||(e[6]=l("h1",{class:"text-2xl md:text-3xl font-bold text-[#78711D] text-center"},"명단 관리",-1)),e[7]||(e[7]=l("div",{class:"w-10"},null,-1))]),l("main",H,[l("section",Q,[e[8]||(e[8]=l("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"현장(지역)",-1)),l("div",X,[(u(!0),c(A,null,D(f.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",n.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[l("span",Y,h(t.name),1),l("button",{type:"button",onClick:i=>R(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,Z)],2))),128))]),l("div",ee,[_(l("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>x.value=t),type:"text",placeholder:"새 현장 이름을 입력해주세요",class:"input-box rounded-md w-full p-2"},null,512),[[k,x.value]]),l("button",{onClick:$,class:"w-full mt-2 bg-black text-[#3A9CFF] border border-[#3A9CFF] font-bold py-2 rounded-md"},"현장 추가")])]),l("section",te,[e[9]||(e[9]=l("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"팀",-1)),l("div",le,[(u(!0),c(A,null,D(j.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",s.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[l("span",oe,h(t.name),1),l("button",{type:"button",onClick:i=>N(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,ne)],2))),128)),n.value&&j.value.length===0?(u(),c("p",ae,"등록된 팀이 없습니다.")):E("",!0)]),l("div",se,[_(l("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>g.value=t),type:"text",placeholder:"새 팀 이름을 입력해주세요",class:"input-box rounded-md w-full p-2",disabled:!n.value},null,8,ie),[[k,g.value]]),l("button",{onClick:B,disabled:!n.value,class:b(["w-full mt-2 font-bold py-2 rounded-md border",n.value?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-300 text-gray-600"])},"팀 추가",10,re)])]),l("section",de,[e[10]||(e[10]=l("h2",{class:"text-xl font-bold text-[#FFEC17] mb-3 text-center"},"팀원",-1)),l("div",ce,[(u(!0),c(A,null,D(r.value,t=>(u(),c("div",{key:t.id,class:b(["flex items-center justify-between p-3 rounded-md border w-full",d.value?.id===t.id?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-100 text-[#1D1A05] hover:bg-[#FFFDE3] border-[#DCD7B8]"])},[l("div",ue,[l("div",pe,h(t.name),1),l("div",ve,h(t.role)+" · "+h(t.phone),1)]),l("button",{type:"button",onClick:i=>U(t),class:"ml-3 px-3 py-1 rounded-md border bg-[#FFEC17] text-[#1D1A05]"},"선택",8,fe)],2))),128)),s.value&&r.value.length===0?(u(),c("p",be,"등록된 팀원이 없습니다.")):E("",!0)]),l("div",me,[l("button",{onClick:e[2]||(e[2]=t=>w.value=!w.value),disabled:!s.value,class:b(["w-full mt-2 font-bold py-2 rounded-md border",s.value?"bg-black text-[#3A9CFF] border-[#3A9CFF]":"bg-gray-300 text-gray-600"])},"팀원 추가하기",10,he),w.value?(u(),c("div",xe,[_(l("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.name=t),type:"text",placeholder:"이름을 입력해주세요",class:"input-box rounded-md w-full p-2"},null,512),[[k,v.value.name]]),_(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>v.value.phone=t),type:"text",placeholder:"전화번호를 입력해주세요 (- 입력 없이 등록)",class:"input-box rounded-md w-full p-2"},null,512),[[k,v.value.phone]]),l("button",{onClick:L,class:"w-full bg-black text-[#3A9CFF] border border-[#3A9CFF] font-bold py-2 rounded-md"},"팀원 추가")])):E("",!0)])])]),l("footer",ge,[l("button",{onClick:V,class:b(["w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl",S.value?"":"opacity-60 cursor-not-allowed"]),disabled:!S.value},"삭제하기",10,we),e[11]||(e[11]=l("p",{class:"text-xs text-gray-300 mt-2"},"가이드 : 선택 수준에 따라 삭제 대상이 달라집니다: 현장만 선택 → 현장 및 하위 전체 / 팀 선택 → 팀 및 팀원 / 팀원 선택 → 해당 팀원",-1))])])])}}},ke=M(ye,[["__scopeId","data-v-890819ea"]]);export{ke as default};
